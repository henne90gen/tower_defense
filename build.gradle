description = """
Tower Defense game, written in python
"""

task requirements(type: Exec) {
    executable 'pip'
    args = ['install', '-r', 'requirements.txt']
}

task buildSetup() {
    new File('./bin').mkdirs()
    new File('./bin/build').mkdirs()
    new File('./bin/dist').mkdirs()
}

task build(dependsOn: ['requirements', 'buildSetup']) {
    doLast {
        def command = 'pyinstaller --onefile --specpath bin --distpath bin/dist --workpath bin/build tower_defense/main.py'
        def proc = command.execute()
        proc.consumeProcessOutput(System.out, System.err)
        proc.waitForOrKill(120000)
    }
}

task clean() {
    doLast {
        new File('./bin').deleteDir()
        println 'Deleted bin'
    }
}

task test(type: Exec, dependsOn: 'requirements') {
    executable 'python'
    args = ['run_tests.py']
}
